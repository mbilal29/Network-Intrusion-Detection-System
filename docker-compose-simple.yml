services:
  ids:
    image: python:3.10-slim
    container_name: ids
    networks:
      ids-net:
        ipv4_address: 10.0.0.10
    volumes:
      - ./ids:/app
    working_dir: /app
    command: >
      bash -c "apt update &&
               apt install -y tshark tcpdump iputils-ping procps net-tools &&
               pip install scapy pyshark pandas numpy matplotlib &&
               echo 'IDS container ready. Run: python3 sniffer.py' &&
               bash"
    tty: true
    stdin_open: true

  attacker:
    image: kalilinux/kali-last-release
    container_name: attacker
    networks:
      ids-net:
        ipv4_address: 10.0.0.20
    command: >
      bash -c "apt update &&
               apt install -y nmap hping3 iputils-ping net-tools python3 python3-pip &&
               pip3 install --break-system-packages scapy &&
               echo 'Attacker container ready. Tools: nmap, hping3, scapy' &&
               bash"
    tty: true
    stdin_open: true

  victim:
    image: ubuntu:20.04
    container_name: victim
    networks:
      ids-net:
        ipv4_address: 10.0.0.30
    command: >
      bash -c "export DEBIAN_FRONTEND=noninteractive &&
               apt update &&
               apt install -y iputils-ping curl net-tools python3 &&
               echo 'Victim container ready' &&
               bash"
    tty: true
    stdin_open: true

networks:
  ids-net:
    external: true
